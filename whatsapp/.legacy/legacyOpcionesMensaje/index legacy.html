<!DOCTYPE html>
<html lang='es'>

  <head>
    <meta charset='UTF-8' />
    <meta name='viewport' content='width=device-width, initial-scale=1.0' />
    <title>WhatsApp 2.0</title>
    <style>
      :root {
        --wa: #25d366;
        --bleed: 14px;
        --nudge: 6px;
        --radius: 999px;
      }

      body {
        font-family: 'Poppins', sans-serif;
        margin: 0;
        background-color: #e3efda;
        display: flex;
        flex-direction: column;
        align-items: center;
        /* padding:20px 16px 24px; */
        min-height: 100vh;
      }

      .close-button {
        width: 30px;
        height: 30px;
        border: none;
        background: transparent;
        color: red;
        font-size: 30px;
        cursor: pointer;
        align-self: flex-start;
        transition: transform 0.15s ease;
      }

      .close-button:hover {
        color: darkred;
        transform: scale(1.05);
      }

      #btnBlank {
        width: 260px;
        height: 64px;
        background-color: #fff;
        border: 3px solid #fff;
        border-radius: 100px;
        font-weight: 700;
        padding-left: 56px;
        background-image: url('https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg');
        background-repeat: no-repeat;
        background-position: 18px center;
        background-size: 30px 30px;
        margin: 12px auto 24px;
        display: block;
        text-align: left;
        transition: all 0.3s ease;
        box-shadow: 0 8px 0 rgba(0, 0, 0, 0.06), 0 6px 18px rgba(0, 0, 0, 0.15);
      }

      #btnBlank:hover {
        background-color: var(--wa);
        color: #fff;
        box-shadow: 0 4px 0 rgba(0, 0, 0, 0.06), 0 10px 24px rgba(0, 0, 0, 0.22);
        transform: translateY(-1px);
      }

      h2 {
        margin: 0 0 14px;
        font-size: 34px;
      }

      .toggle-container {
        position: relative;
        width: 300px;
        height: 58px;
        background-color: #fffdfd;
        border-radius: var(--radius);
        display: flex;
        align-items: center;
        overflow: hidden;
        margin-bottom: 18px;
        cursor: pointer;
        transition: box-shadow 0.25s ease;
        box-shadow: inset 0 -2px 0 rgba(255, 255, 255, 0.5),
          inset 0 3px 10px rgba(0, 0, 0, 0.06);
      }

      .toggle-option {
        flex: 1 1 50%;
        height: 100%;
        z-index: 2;
        font-weight: 800;
        color: #6b6b6b;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        transition: color 0.25s ease, transform 0.25s ease;
        position: relative;
      }

      .toggle-option img {
        width: 22px;
        height: 22px;
        opacity: 0;
        transition: opacity 0.25s ease;
      }

      .toggle-option.active {
        color: #fff;
      }

      .toggle-option.active img {
        opacity: 1;
      }

      #optWeb.active {
        flex-direction: row-reverse;
      }

      #optApp.active {
        flex-direction: row;
      }

      .toggle-slider {
        position: absolute;
        top: 0;
        left: calc(-1 * var(--bleed));
        width: calc(50% + var(--bleed));
        height: 100%;
        background-color: var(--wa);
        border-radius: var(--radius);
        z-index: 1;
        transition: left 0.28s ease;
        box-shadow: 0 3px 12px rgba(0, 0, 0, 0.15);
      }

      .peek-left .toggle-slider {
        left: calc(-1 * var(--bleed) - var(--nudge));
      }

      .peek-right .toggle-slider {
        left: calc(50% - var(--bleed) + var(--nudge));
      }

      #optWeb:not(.active):hover::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: calc(-1 * var(--bleed));
        bottom: 0;
        border: 2px solid var(--wa);
        border-radius: var(--radius);
        pointer-events: none;
        z-index: 3;
      }

      #optApp:not(.active):hover::after {
        content: '';
        position: absolute;
        top: 0;
        left: calc(-1 * var(--bleed));
        right: 0;
        bottom: 0;
        border: 2px solid var(--wa);
        border-radius: var(--radius);
        pointer-events: none;
        z-index: 3;
      }

      .dropdown {
        width: 320px;
        position: relative;
        user-select: none;
      }

      .dropdown-toggle {
        width: 100%;
        height: 50px;
        border: 0;
        border-radius: 14px;
        background: #fff;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 16px;
        font-size: 16px;
        cursor: pointer;
        box-shadow: none;
        transition: box-shadow 0.2s ease, transform 0.15s ease;
      }

      .dropdown-toggle:hover {
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.18);
        transform: translateY(-1px);
      }

      .dropdown-toggle .label {
        color: #333;
        font-weight: 700;
      }

      .chevron {
        width: 0;
        height: 0;
        border-left: 7px solid transparent;
        border-right: 7px solid transparent;
        border-top: 7px solid #333;
        transition: transform 0.2s ease;
      }

      .dropdown.open .chevron,
      .dropdown:hover .chevron {
        transform: rotate(180deg);
      }

      .dropdown-menu {
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        background: #fff;
        border-radius: 16px;
        padding: 6px;
        box-shadow: 0 16px 28px rgba(0, 0, 0, 0.18), 0 8px 0 rgba(0, 0, 0, 0.04);
        margin-top: 0;
        opacity: 0;
        pointer-events: none;
        transform: translateY(-4px);
        transition: opacity 0.18s ease, transform 0.18s ease;
        max-height: 260px;
        overflow: auto;
      }

      .dropdown.open .dropdown-menu,
      .dropdown:hover .dropdown-menu {
        opacity: 1;
        transform: translateY(0);
        pointer-events: auto;
      }

      .dropdown-menu li {
        list-style: none;
        border-radius: 12px;
        padding: 12px;
        margin: 4px 2px;
        font-weight: 600;
        color: #3b3b3b;
        cursor: pointer;
        transition: background 0.15s ease, color 0.15s ease,
          transform 0.08s ease;
        box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.03);
      }

      .dropdown-menu li:hover {
        background: var(--wa);
        color: #fff;
        transform: translateY(-1px);
        box-shadow: 0 6px 14px rgba(0, 0, 0, 0.16),
          inset 0 2px 0 rgba(255, 255, 255, 0.35);
      }

      .dropdown-menu li.selected {
        background: var(--wa);
        color: #fff;
        box-shadow: 0 6px 14px rgba(0, 0, 0, 0.16),
          inset 0 2px 0 rgba(255, 255, 255, 0.35);
      }
    </style>
  </head>

  <body>
    <button id='btnClose' class='close-button' aria-label='Cerrar'>
      &times;
    </button>
    <button id='btnBlank'>Mensaje en Blanco</button>
    <h2>Abrir en:</h2>
    <div class='toggle-container' id='toggleContainer' aria-label='Alterna Web/App'>
      <div class='toggle-slider' id='toggleSlider'></div>
      <div id='optWeb' class='toggle-option active'>
        <img src='https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg' alt='WhatsApp' />WEB
      </div>
      <div id='optApp' class='toggle-option'>
        <img src='https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg' alt='WhatsApp' />APP
      </div>
    </div>
    <div class='dropdown' id='actionsDropdown'>
      <button class='dropdown-toggle' id='ddToggle' type='button' aria-haspopup='listbox' aria-expanded='false'>
        <span class='label' id='ddLabel'>-- Selecciona un tema --</span>
        <span class='chevron' aria-hidden='true'></span>
      </button>
      <ul class='dropdown-menu' id='ddMenu' role='listbox' aria-labelledby='ddToggle'></ul>
    </div>
    <script>
      const toggleContainer = document.getElementById('toggleContainer');
      const toggleSlider = document.getElementById('toggleSlider');
      const optWeb = document.getElementById('optWeb');
      const optApp = document.getElementById('optApp');
      const dropdown = document.getElementById('actionsDropdown');
      const ddToggle = document.getElementById('ddToggle');
      const ddMenu = document.getElementById('ddMenu');
      const ddLabel = document.getElementById('ddLabel');
      const btnClose = document.getElementById('btnClose');
      const btnBlankFM = document.getElementById('btnBlank');
      let isApp = '"& $isWebApp & "' === 'APP' ? true : false;
      let datos = {};
      const options = "& $options &";

      function createOptions() {
        options.forEach((options) => {
          const listItem = document.createElement('li');
          listItem.textContent = options.option;
          listItem.setAttribute('data-value', options.key);
          ddMenu.appendChild(listItem);
        });
      }

      function updateToggle() {
        if (isApp) {
          toggleSlider.style.left = 'calc(50% - var(--bleed))';
          optApp.classList.add('active');
          optWeb.classList.remove('active');
        } else {
          toggleSlider.style.left = 'calc(-1 * var(--bleed))';
          optWeb.classList.add('active');
          optApp.classList.remove('active');
        }
      }

      function execFileMaker(data) {
        if (typeof FileMaker !== 'undefined') {
          FileMaker.PerformScript(
            'api.WhatsApp ## msg.selectTypeAndPrep[js]|v0.25.2',
            JSON.stringify(data)
          );
        } else {
          console.log('FileMaker no definido. Datos a enviar:', data);
        }
      }

      function inicializar() {
        const defaultData = {
          whatsNumber: ' "& $whatsNumber & "',
          classRecordIDoU : '"& $classRecordIDoU &"',
          contactoNombre: '" & $contactoNombre & "',
          className: '" & $className &"'
        };
        datos = defaultData;
      }

      function enviarAccion(callType, msgType = '') {
        const payload = {
          ...datos,
          isWebApp: isApp ? 'APP' : 'WEB',
          callType: callType,
          msgType: msgType,
        };
        setTimeout(() => execFileMaker(payload), 500);
      }

      createOptions();

      btnClose.addEventListener('click', () => enviarAccion('closeDiv'));
      btnBlankFM.addEventListener('click', () =>
        enviarAccion('openWhatsApp', '')
      );

      optWeb.addEventListener('mouseenter', () => {
        toggleContainer.classList.add('peek-left');
        toggleContainer.classList.remove('peek-right');
      });
      optApp.addEventListener('mouseenter', () => {
        toggleContainer.classList.add('peek-right');
        toggleContainer.classList.remove('peek-left');
      });
      toggleContainer.addEventListener('mouseleave', () => {
        toggleContainer.classList.remove('peek-left', 'peek-right');
      });
      optWeb.addEventListener('click', () => {
        isApp = false;
        updateToggle();
      });
      optApp.addEventListener('click', () => {
        isApp = true;
        updateToggle();
      });

      ddToggle.addEventListener('click', (e) => {
        e.stopPropagation();
        const open = dropdown.classList.toggle('open');
        ddToggle.setAttribute('aria-expanded', open ? 'true' : 'false');
      });
      document.addEventListener('click', () => {
        dropdown.classList.remove('open');
        ddToggle.setAttribute('aria-expanded', 'false');
      });

      ddMenu.querySelectorAll('li').forEach((li) => {
        let msgType = '';
        li.addEventListener('click', (e) => {
          e.stopPropagation();
          ddMenu
            .querySelectorAll('li')
            .forEach((n) => n.classList.remove('selected'));
          li.classList.add('selected');
          const value = li.getAttribute('data-value');
          ddLabel.textContent = li.textContent.trim();
          dropdown.classList.remove('open');
          ddToggle.setAttribute('aria-expanded', 'false');
          options.forEach((options) => {
            if (options.key === value) {
              msgType = options.action;
            }
          });
          if (msgType) enviarAccion('selectMsgType', msgType);
        });
      });

      inicializar();
      updateToggle();
    </script>
  </body>

</html>