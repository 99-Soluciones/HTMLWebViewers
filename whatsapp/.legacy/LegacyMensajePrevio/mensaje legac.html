 <!DOCTYPE html>
<html lang='es'>
  <head>
    <meta charset='UTF-8' />
    <meta name='viewport' content='width=device-width, initial-scale=1.0' />
    <title>Editor y Copiador de Texto</title>
    <style>
      html,
      body {
        height: 100%;
        margin: 0px;
        padding: 0px !important;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          Helvetica, Arial, sans-serif;
      }
      body {
        display: flex;
        flex-direction: column;
        padding: 15px;
        box-sizing: border-box;
      }
      button {
        font-size: 16px;
        padding: 5px;
      }
      #textEditor {
        width: 100%;
        flex-grow: 1;
        margin-bottom: 15px;
        padding: 10px;
        font-size: 14px;
        border: 1px solid #ccc;
        border-radius: 8px;
        box-sizing: border-box;
        resize: vertical;
        margin-top: 14px;
      }
      .controls {
        display: flex;
        align-items: center;
      }
      #copyButton {
        padding: 10px 20px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        background-color: #007aff;
        color: white;
        border: none;
        border-radius: 8px;
        transition: background-color 0.2s;
      }
      #copyButton:hover {
        background-color: #005ecb;
      }
      #copyFeedback {
        margin-left: 15px;
        color: #34c759;
        font-weight: bold;
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
      }
      .close-button {
        position: static;
        top: 30px;
        left: 30px;
        width: 30px;
        height: 30px;
        border: none;
        background-color: transparent;
        color: rgb(255, 0, 0);
        font-size: 30px;
        font-weight: bold;
        line-height: 1;
        cursor: pointer;
        padding-left: 0px;
        justify-content: center;
        align-items: center;
        margin-bottom: 10px;
      }
      .close-button:hover {
        color: #a81f1f;
      }
    </style>
  </head>
  <body>
    <button id='btnClose' class='close-button' title='Cerrar'>&times;</button>
    <textarea id='textEditor' aria-label='Editor de texto'></textarea>

    <div class='controls'>
      <button id='copyButton'>Copiar y enviar</button>
      <span id='copyFeedback'></span>
    </div>

    <script>
      function execFileMaker(data) {
        if (typeof FileMaker !== 'undefined') {
          FileMaker.PerformScript(
            'api.WhatsApp -#- cliente.MASTER[js]|v0.25.2',
            JSON.stringify(data)
          );
        } else {
          console.log('FileMaker no definido. Datos a enviar:', data);
        }
      }

      const textEditor = document.getElementById('textEditor');
      const copyButton = document.getElementById('copyButton');
      const btnClose = document.getElementById('btnClose');
      const copyFeedback = document.getElementById('copyFeedback');

      textEditor.value = `" & $msg & "`;

      
      btnClose.addEventListener('click', () => {
        const clData = {
        whatsNumber: ' " & $whatsNumber &"',
        clienteID: '"& $clienteID &"',
        isWebApp: ' " & $isWebApp &"',
        callType: 'closeDiv',
        };
        execFileMaker(clData);
      });

      copyButton.addEventListener('click', () => {
        navigator.clipboard
          .writeText(textEditor.value)
          .then(() => {
            copyFeedback.textContent = 'Â¡Copiado!';
            copyFeedback.style.opacity = 1;
            setTimeout(() => {
              copyFeedback.style.opacity = 0;
            }, 2000);
          })
          .catch((err) => {
            console.error('Error al copiar: ', err);
            copyFeedback.textContent = 'Error';
            copyFeedback.style.color = 'red';
            copyFeedback.style.opacity = 1;
          });

        const datos = {
          whatsNumber: ' " & $whatsNumber &"',
          clienteID: '"& $clienteID &"',
          isWebApp: ' " & $isWebApp &"',
          callType: 'CopySendMSG',
        };

        setTimeout(() => {
          execFileMaker(datos);
        }, 1500);
      });
    </script>
  </body>
</html>